import requests, re, sys, time

asn = '13335'

bgp = requests.get('http://bgp.he.net/AS' + asn, headers={'User-Agent':'Mozilla/5.0 So nice security on this place'})

if bgp.status_code != 200:
	sys.exit('he.net Error')


prefixes = re.findall(re.compile(r'\/net\/(.*?)".*[\n|\s|</td>|<td>]+(.*?)\n', re.MULTILINE), bgp.content)

title = re.search('rel=\"bookmark\" title=\"(.*?)\">', bgp.content)

if not title:
	sys.exit('Invalid title.')

if not prefixes:
	sys.exit('No prefixes found')

out = '\n# %s - %s' % (title.group(1), time.strftime("%d/%m/%Y"))

for prefix in prefixes:
	if prefix[0].find(':') == -1:
		out += '\ndeny %s; #%s' % (prefix)

print out
